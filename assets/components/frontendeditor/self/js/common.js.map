{"version":3,"sources":["src/common.js"],"names":["FrontendEditor","editingMode","saved","document","querySelector","innerHTML","frontendEditorOptions","frontendEditorLexicon","options","lexicon","state","editPermission","disabled","fe","editableAreas","querySelectorAll","selector","forEach","call","el","addEventListener","edit","bind","frontendeditor","save","initOptions","initEditableAreasEvents","id","constructor","generateUUID","dataset","split","firstOption","trim","_isInt","frontendeditorResourceId","title","console","log","frontendeditorEditor","elin","oninput","elout","menutitleBehavior","linked","$onloadFunction","$process","data","FormData","append","getAll","includes","_send","currentTarget","error","status","response","success","objects","object","field","elp","frontendeditorLoadData","messageBoxShow","compatMode","assetsPath","length","classList","add","loadContent","setAttribute","tinymceInit","parentElement","toggle","remove","hasChange","confirm","tinymce","removeAttribute","result","tinyMCE","get","undoManager","hasUndo","ResourceId","has","encodeURIComponent","onloadFunction","xhr","XMLHttpRequest","open","url","responseType","onload","send","value","isNaN","x","parseFloat","timeout","addclass","messageBox","setTimeout","config","language","lang","images_upload_handler","blobInfo","failure","formData","blob","filename","message","file_picker_types","file_picker_callback","callback","type","activeEditor","windowManager","openUrl","media","madia","onMessage","api","mceAction","close","tinymceConfig","tinymceConfigString","_decodeEntities","Object","assign","JSON","parse","init","d","Date","getTime","d2","performance","now","replace","c","r","Math","random","floor","toString","encodedString","textArea","createElement"],"mappings":"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","file":"common.js","sourcesContent":["class FrontendEditor {\n\n    constructor(){\n        this.editingMode = false;\n        this.saved = false;\n\n        document.querySelector(`body`).innerHTML+= `<div class=\"frontendeditor-topbabr\">\n            <div class=\"frontendeditor-message-box\"></div>\n            <button class=\"frontendeditor-button frontendeditor-button-edit\"><i class=\"far fa-edit\"></i><i class=\"far fa-times-circle\"></i></button>\n            <button class=\"frontendeditor-button frontendeditor-button-save\"><i class=\"far fa-save\"></i></button>\n        </div>`;\n\n    }\n\n    init(frontendEditorOptions, frontendEditorLexicon){\n        this.options = frontendEditorOptions;\n        this.lexicon = frontendEditorLexicon;\n        this.state = {};\n\n        if(this.options.editPermission !== `1`){\n            document.querySelector(`.frontendeditor-button-edit`).disabled = true;\n        }else{\n            const fe = this;\n            fe.editableAreas = [...document.querySelectorAll(fe.options.selector)];\n\n            [].forEach.call(document.querySelectorAll(`.frontendeditor-button-edit`), function (el) {\n                el.addEventListener(`click`, fe.edit.bind(fe), false);\n                el.frontendeditor = fe;\n            });\n\n            [].forEach.call(document.querySelectorAll(`.frontendeditor-button-save`), function (el) {\n                el.addEventListener(`click`, fe.save.bind(fe));\n            });\n\n            this.initOptions();\n            this.initEditableAreasEvents();\n        }\n    }\n\n    initOptions() {\n        this.editableAreas.forEach((el) => {\n            el.id = this.constructor.generateUUID();\n            let options = el.dataset.frontendeditor.split(\",\");\n            let firstOption = options[0].trim();\n\n            if(this._isInt(firstOption)) {\n                el.dataset.frontendeditorResourceId = firstOption;\n                el.title = `ID: ${firstOption}`;\n\n                if (1 in options) {\n                    el.dataset.frontendeditor = options[1].trim();\n                    el.title = `ID: ${firstOption} Filed: ${options[1].trim()}`;\n                }else{\n                    console.log(`${this.lexicon['error_options_format']} ${options}`)\n                    return;\n                }\n                if (2 in options)\n                    el.dataset.frontendeditorEditor = options[2].trim();\n            }else{\n                el.dataset.frontendeditorResourceId = this.options.id;\n                el.dataset.frontendeditor = firstOption;\n                el.title = `Filed: ${firstOption}`;\n\n                if (1 in options) {\n                    el.dataset.frontendeditorEditor = options[1].trim();\n                }\n            }\n\n\n        });\n    }\n\n    initEditableAreasEvents() {\n        this.editableAreas.forEach((elin) => {\n            const fe = this;\n            elin.oninput = function() {\n                fe.editableAreas.forEach((elout) => {\n                    if(elin.dataset.frontendeditorResourceId === elout.dataset.frontendeditorResourceId)\n                        if(this.options.menutitleBehavior === '2' && 'linked' in elin.dataset) {\n                            if ((elout.dataset.frontendeditor === elin.dataset.linked || elin.dataset.frontendeditor === elout.dataset.frontendeditor) && elin !== elout)\n                                elout.innerHTML = elin.innerHTML;\n                        } else {\n                            if (elin.dataset.frontendeditor === elout.dataset.frontendeditor && elin !== elout )\n                                elout.innerHTML = elin.innerHTML;\n                        }\n                });\n            }.bind(fe, elin);\n        });\n    }\n\n    loadContent($onloadFunction, $process = false) {\n\n        let data = new FormData();\n        data.append(\"action\", \"getall\");\n\n        this.editableAreas.forEach((el) => {\n            let id = el.dataset.frontendeditorResourceId;\n            if (!data.getAll(\"ids[]\").includes(id))\n                data.append(\"ids[]\", id);\n        });\n\n        data.append(\"process\", $process);\n\n\n        this._send(data, function ({currentTarget}) {\n            let error = false;\n            if (currentTarget.status === 200 && currentTarget.response.success) {\n                let objects = currentTarget.response.object;\n                this.editableAreas.forEach((el) => {\n                    el.id = this.constructor.generateUUID();\n                    let id = el.dataset.frontendeditorResourceId;\n                    let field = el.dataset.frontendeditor;\n\n                    if (field in objects[id]) {\n                        if((this.options.menutitleBehavior === '1' || this.options.menutitleBehavior === '2') && field === 'menutitle' && objects[id]['menutitle'] === '') {\n                            el.dataset.linked = 'pagetitle';\n\n                            if(this.options.menutitleBehavior === '2')\n                                if(el.dataset.frontendeditorResourceId !== this.options.id) {\n                                    el.title = `ID: ${el.dataset.frontendeditorResourceId} Filed: ${field} -> ${el.dataset.linked}`;\n                                }else{\n                                    el.title = `Filed: ${field} -> ${el.dataset.linked}`;\n                                }\n\n                            this.editableAreas.forEach((elp) => {\n                                if(elp.dataset.frontendeditorResourceId === el.dataset.frontendeditorResourceId && elp.dataset.frontendeditor === el.dataset.linked) {\n                                    elp.dataset.linked = 'menutitle';\n                                }\n                            });\n                        }\n                        if('linked' in el.dataset && objects[id]['pagetitle'] !== '')\n                            el.innerHTML = objects[id]['pagetitle'];\n                        else\n                            el.innerHTML = objects[id][field];\n                        el.dataset.frontendeditorLoadData = `true`;\n                        this.state[el.id] = el.innerHTML;\n                    }else{\n                        this.constructor.messageBoxShow(5000, \"error\").innerHTML = `${this.lexicon['error_content_for']} ${field}`;\n                        error = true;\n                        this.state[el.id] = null;\n                    }\n                });\n            } else {\n                this.constructor.messageBoxShow(5000, \"error\").innerHTML = `${this.lexicon['error_content_load']}<br>${currentTarget.status}`;\n                error = true;\n            }\n            if(!error){\n                $onloadFunction();\n            }\n        }.bind(this))\n    }\n\n    edit({currentTarget}) {\n        const fe = this;\n\n        if(!fe.editingMode) {\n\n            // checking browser \"Quirks Mode\"\n            if(document.compatMode === \"BackCompat\"){\n                this.constructor.messageBoxShow(3600000, \"error\").innerHTML = `${this.lexicon['error_browser_back_compat']} <a href=\"${this.options.assetsPath}self/doc/quirksmode.txt\" target=\"_blank\">${this.lexicon['see_more']}</a>`;\n                document.querySelector(`.frontendeditor-button-edit`).disabled = true;\n                return;\n            }\n\n            if(fe.editableAreas.length === 0 ){\n                this.constructor.messageBoxShow(10000, \"error\").innerHTML = `${this.lexicon['error_no_editable_areas']} `;\n                document.querySelector(`.frontendeditor-button-edit`).disabled = true;\n                return;\n            }\n\n            currentTarget.disabled = true;\n            document.querySelector(`.frontendeditor-topbabr`).classList.add(`frontendeditor-loading-data`);\n            fe.loadContent(function () {\n                fe.editableAreas.forEach(function (el) {\n                    if(el.dataset.frontendeditorLoadData)\n                        switch (el.dataset.frontendeditorEditor) {\n                            case 'simple':\n                                el.setAttribute('contenteditable',true);\n                                break;\n                            case 'tinymce':\n                            default:\n                                fe.constructor.tinymceInit(el, fe);\n                                break;\n                        }\n                });\n                fe.editingMode = true;\n                fe.saved = false;\n                currentTarget.parentElement.classList.toggle(`frontendeditor-edit-mode`);\n                document.querySelector(`body`).classList.add(`frontendeditor-areas-highlight`);\n                currentTarget.disabled = false;\n                document.querySelector(`.frontendeditor-topbabr`).classList.remove(`frontendeditor-loading-data`);\n            }, false);\n        }else{\n            if(fe.saved || !fe.hasChange() || confirm(fe.lexicon['exit_without_saving'])) {\n                tinymce.remove();\n                fe.editableAreas.forEach(function (el) {\n                    if(el.dataset.frontendeditorEditor === 'simple')\n                        el.removeAttribute('contenteditable');\n                });\n                fe.editingMode = false;\n                currentTarget.disabled = true;\n                document.querySelector(`.frontendeditor-topbabr`).classList.add(`frontendeditor-loading-data`);\n                fe.loadContent(function () {\n                    currentTarget.disabled = false;\n                    document.querySelector(`.frontendeditor-topbabr`).classList.remove(`frontendeditor-loading-data`);\n                }, true);\n\n                currentTarget.parentElement.classList.toggle(`frontendeditor-edit-mode`);\n                document.querySelector(`body`).classList.remove(`frontendeditor-areas-highlight`);\n\n            }\n        }\n    }\n\n    hasChange() {\n        let result = false;\n        this.editableAreas.forEach(function (el) {\n            if(tinyMCE.get(el.id) && tinyMCE.get(el.id).undoManager.hasUndo())\n                result = true;\n        });\n        return result\n    }\n\n    save() {\n        let data = new FormData();\n        data.append(\"action\", \"update\");\n\n        this.editableAreas.forEach((el) => {\n            if(el.dataset.frontendeditorLoadData && this.state[el.id] !== null && this.state[el.id] !== el.innerHTML) {\n                let ResourceId = \"r\" + el.dataset.frontendeditorResourceId;\n                if (!data.has(ResourceId+ \"[id]\"))\n                    data.append(ResourceId+ \"[id]\", el.dataset.frontendeditorResourceId);\n\n                if(!(this.options.menutitleBehavior === '2' && el.dataset.frontendeditor === 'menutitle'))\n                    if (!data.has(ResourceId + \"[\" + el.dataset.frontendeditor + \"]\"))\n                        data.append(ResourceId + \"[\" + el.dataset.frontendeditor + \"]\", encodeURIComponent(el.innerHTML));\n\n                this.state[el.id] = el.innerHTML;\n            }\n        });\n\n        this._send(data, function({currentTarget}) {\n            if (currentTarget.status === 200 && currentTarget.response.success) {\n                this.constructor.messageBoxShow().innerHTML = this.lexicon['exit_saving'];\n                this.saved = true;\n            } else {\n                this.constructor.messageBoxShow(5000, \"error\").innerHTML = `${this.lexicon['error']}<br>${currentTarget.status === 200 ? currentTarget.response.success : currentTarget.status}`;\n            }\n        }.bind(this))\n    }\n\n    _send(data, onloadFunction) {\n        const xhr = new XMLHttpRequest();\n        xhr.open(`POST`, this.options.url);\n        xhr.responseType = 'json';\n        xhr.onload = onloadFunction;\n        xhr.send(data);\n    }\n\n    _isInt(value) {\n        return !isNaN(value) && (function(x) { return (x | 0) === x; })(parseFloat(value))\n    }\n\n    static messageBoxShow(timeout = 5000, addclass = \"\") {\n        let messageBox = document.querySelector(`.frontendeditor-message-box`);\n        messageBox.classList.add(`frontendeditor-box-show`);\n        if(addclass !== \"\") messageBox.classList.add(addclass);\n        setTimeout(function () {\n            if(addclass !== \"\") messageBox.classList.remove(addclass);\n            messageBox.classList.remove(`frontendeditor-box-show`);\n        }, timeout);\n        return messageBox;\n    }\n\n    static tinymceInit(el, fe) {\n\n        let config = {\n            selector: `#${el.id}`,\n            language: fe.options.lang,\n            images_upload_handler: function (blobInfo, success, failure) {\n\n                let formData = new FormData();\n                formData.append('file', blobInfo.blob(), blobInfo.filename());\n                formData.append(\"action\", \"upload\");\n                formData.append(\"id\", fe.options.id);\n\n                fe._send(formData, function({currentTarget}) {\n                    if (currentTarget.status === 200 && currentTarget.response.success) {\n                        success(currentTarget.response.object[`url`]);\n                    } else {\n                        failure('Error: ' + currentTarget.response.message);\n                    }\n                }.bind(this));\n            },\n            file_picker_types: 'image',\n            file_picker_callback: function(callback, url, type) {\n                tinymce.activeEditor.windowManager.openUrl({\n                    title: \"MODX Resource Browser\",\n                    url: '/manager/index.php?a=browser'+ (fe.options.media !== \"\" ? '&source=' + fe.options.madia : '') +'&frontendeditor=1',\n                    onMessage: function (api, data) {\n                        if (data.mceAction === 'browserSelectCompleted') {\n                            callback(data.url);\n                            api.close();\n                        }\n                    }\n                });\n                return false;\n            }\n        };\n\n        if(fe.options.tinymceConfig) {\n            let tinymceConfigString = fe.constructor._decodeEntities(fe.options.tinymceConfig);\n            config = Object.assign(config, JSON.parse(tinymceConfigString));\n        }\n\n        tinymce.init(config);\n    }\n\n    static generateUUID() {\n        let d = new Date().getTime();\n        let d2 = (performance && performance.now && (performance.now()*1000)) || 0;\n        return `xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`.replace(/[xy]/g, function(c) {\n            let r = Math.random() * 16;\n            if(d > 0){\n                r = (d + r)%16 | 0;\n                d = Math.floor(d/16);\n            } else {\n                r = (d2 + r)%16 | 0;\n                d2 = Math.floor(d2/16);\n            }\n            return (c === `x` ? r : (r & 0x3 | 0x8)).toString(16);\n        });\n    }\n\n    static _decodeEntities(encodedString) {\n        var textArea = document.createElement('textarea');\n        textArea.innerHTML = encodedString;\n        return textArea.value;\n    }\n\n}\n\nvar frontendeditor = new FrontendEditor();\n\n"]}